const XLSX = require('xlsx');

// 新しいワークブックを作成
const workbook = XLSX.utils.book_new();

// 使い方シート
const usageData = [
  ['株式会社Festal メール配信システム - 完全ガイド'],
  [''],
  ['🌐 Webアプリケーション'],
  ['URL: https://auto-mail-three.vercel.app/'],
  ['※ ブックマーク推奨：社内の誰でもアクセス可能'],
  [''],
  ['🚀 使用手順（ステップバイステップ）'],
  [''],
  ['【STEP 1】Microsoft認証'],
  ['1. 上記URLにアクセスしてください'],
  ['2. 「Microsoftでログイン」ボタンをクリック'],
  ['3. Festalのメールアドレス(@festal-inc.com)でログイン'],
  ['4. 認証完了後、送信者として自動設定されます'],
  ['   ※ 他人のメールアドレスは使用できません（セキュリティ保護）'],
  [''],
  ['【STEP 2】ファイルアップロード'],
  ['1. 「宛先リスト」シートに送信先情報を入力'],
  ['2. ファイルをドラッグ&ドロップまたは「ファイルを選択」'],
  ['3. 対応形式：Excel(.xlsx/.xls)、CSV(.csv)'],
  ['4. アップロード成功後、テンプレート作成画面に自動遷移'],
  [''],
  ['【STEP 3】メールテンプレート作成'],
  ['1. 件名欄に件名を入力（変数使用可能）'],
  ['2. 本文欄にメール本文を入力（変数使用可能）'],
  ['3. リアルタイムプレビューで仕上がりを確認'],
  ['4. 送信間隔を設定（1-10秒、推奨：3秒）'],
  ['5. 「プレビューを確認」ボタンで最終確認'],
  [''],
  ['【STEP 4】送信実行'],
  ['1. プレビュー画面で全ての宛先を確認'],
  ['2. 内容に問題なければ「メール送信開始」をクリック'],
  ['3. 送信状況をリアルタイムで監視'],
  ['4. 完了後、成功/失敗件数を確認'],
  [''],
  ['📋 データ形式要件'],
  [''],
  ['【必須カラム】※ 必ず含めてください'],
  ['• email: 送信先メールアドレス'],
  ['• name: 宛先の氏名'],
  [''],
  ['【オプションカラム】※ 任意'],
  ['• company: 会社名'],
  ['• department: 部署名'],
  ['• position: 役職名'],
  [''],
  ['🔧 テンプレート変数システム'],
  [''],
  ['【利用可能な変数】'],
  ['• {name} → 宛先の氏名に置換'],
  ['• {email} → 宛先のメールアドレスに置換'],
  ['• {company} → 会社名に置換'],
  ['• {department} → 部署名に置換'],
  ['• {position} → 役職名に置換'],
  [''],
  ['【変数の使用例】'],
  ['件名: 【{company}】{department}の{position}様へ重要なお知らせ'],
  [''],
  ['本文:'],
  ['{name}様（{position}）'],
  [''],
  ['いつもお世話になっております。'],
  [''],
  ['{company}の{department}でご活躍の{name}様に、'],
  ['重要なお知らせをお送りいたします。'],
  [''],
  ['▼ 対象部署：{department}'],
  ['▼ 対象役職：{position}'],
  ['▼ 連絡先：{email}'],
  [''],
  ['各部署・役職に応じた内容で自動的に個別化されます。'],
  [''],
  ['何かご不明な点がございましたら、お気軽にお問い合わせください。'],
  [''],
  ['よろしくお願いいたします。'],
  [''],
  ['⚠️ 重要な注意事項'],
  [''],
  ['【セキュリティ】'],
  ['• 送信者は認証したアカウントに固定'],
  ['• 他人のメールアドレスでの送信は不可'],
  ['• Festalドメイン(@festal-inc.com)のみ利用可能'],
  [''],
  ['【データ要件】'],
  ['• emailとnameは必須項目（空白不可）'],
  ['• 変数が空の場合は空文字に置換'],
  ['• Excel使用時は「宛先リスト」シートを自動読込'],
  ['• CSV使用時は任意のファイル名でOK'],
  [''],
  ['【送信設定】'],
  ['• 大量送信時は適切な送信間隔を設定'],
  ['• 推奨間隔：100件未満=1秒、100件以上=3-5秒'],
  ['• 送信エラー時は個別にログ表示'],
  [''],
  ['【トラブルシューティング】'],
  ['• ログインできない → Festalアカウントか確認'],
  ['• ファイル読込エラー → 必須カラム(email/name)を確認'],
  ['• 送信失敗 → 宛先メールアドレスの形式を確認'],
  ['• 変数が置換されない → 変数名の大文字小文字を確認'],
  [''],
  ['💡 効率的な使い方のコツ'],
  [''],
  ['1. テンプレートを事前に準備しておく'],
  ['2. 宛先リストは部署・役職別に整理'],
  ['3. プレビュー機能で必ず最終確認'],
  ['4. 送信後は結果ログを保存'],
  ['5. 定期的に使用する場合はブックマーク登録']
];

const usageSheet = XLSX.utils.aoa_to_sheet(usageData);

// 宛先リストシート
const contactsData = [
  ['email', 'name', 'company', 'department', 'position'],
  ['sample1@example.com', 'サンプル太郎', 'サンプル株式会社', '営業部', '営業マネージャー'],
  ['sample2@example.com', 'サンプル花子', 'サンプル株式会社', '開発部', 'エンジニア'],
  ['sample3@example.com', 'サンプル次郎', 'サンプル株式会社', 'マーケティング部', 'マーケティング担当'],
  ['sample4@example.com', 'サンプル三郎', 'サンプル株式会社', '人事部', '人事担当'],
  ['sample5@example.com', 'サンプル四郎', 'サンプル株式会社', '総務部', '総務担当'],
  ['', '', '', '', ''],
  ['※ 上記はサンプルデータです。実際のデータに置き換えてください。'],
  ['※ email と name は必須項目です。'],
  ['※ company, department, position は任意項目です。']
];

const contactsSheet = XLSX.utils.aoa_to_sheet(contactsData);

// シートをワークブックに追加
XLSX.utils.book_append_sheet(workbook, usageSheet, '使い方');
XLSX.utils.book_append_sheet(workbook, contactsSheet, '宛先リスト');

// Excelファイルとして保存
XLSX.writeFile(workbook, 'メール配信テンプレート.xlsx');

console.log('✅ テンプレートファイル「メール配信テンプレート.xlsx」を作成しました！');
console.log('📋 シート構成:');
console.log('  - 使い方: システムの使用方法とテンプレート例');
console.log('  - 宛先リスト: 実際のデータを入力するシート');
console.log('🚀 システムは「宛先リスト」シートを自動で読み込みます');
